---
# Creating tap interfaces nad bridges 
#

    - name: List the Virtual Machine
      virt: command=list_vms
      register: virt_vms
    
    - name: Destroy guest VM of k8s instances
      virt: name={{ item.name }}
            state=destroyed
      with_items: "{{ k8s_inst }}"
      when: item.name in virt_vms.list_vms

    - name: UNdefine guest VM of k8s instances
      virt: name={{ item.name }}
            command=undefine
      with_items: "{{ k8s_inst }}"
      when: item.name in virt_vms.list_vms

    - name: DELETE qcow2 file to image folder for k8s instances
      file:
        path: "{{ kvm_images_location }}/{{ item.name }}.qcow2"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE xml file to image folder for k8s instances
      file:
        path: "{{ kvm_images_location }}/{{ item.name }}.xml"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE disable-netmanager script files k8s instances
      file:
        path: "/tmp/disable-netmanager-{{ item.name }}.sh"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE ifcfg-eth0 files for k8s instances
      file:
        path: "/tmp/ifcfg-eth0.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE ifcfg-eth1 files for k8s instances
      file:
        path: "/tmp/ifcfg-eth1.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE hostname files for k8s instances
      file:
        path: "/tmp/ifcfg-hostname.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE resolv.conf and network files
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - '/tmp/resolv.conf'
        - '/tmp/network'

