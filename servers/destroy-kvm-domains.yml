---
# Creating tap interfaces nad bridges 
#

    - name: List qemu containers
      shell: "docker ps --format {{ '{{' }}.Names{{ '}}' }} | grep qemu | cat"
      register: qemu_containers
      changed_when: False

    - name: Check qemu_containers
      debug:
        msg: "qemu containers: {{ qemu_containers.stdout }}"

    - name: Stop qemu containers
      command: docker stop qemu-{{ item.name }}
      with_items: "{{ k8s_inst }}"
      when: "'qemu' in qemu_containers.stdout"


    - name: DELETE qcow2 file to image folder for k8s instances
      file:
        path: "{{ kvm_images_location }}/{{ item.name }}.qcow2"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE guestfish-files.sh script files k8s instances
      file:
        path: "/tmp/guestfish-files-{{ item.name }}.sh"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE mgmt.nmconnection files for k8s instances
      file:
        path: "/tmp/mgmt.nmconnection.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE srv.nmconnection files for k8s instances
      file:
        path: "/tmp/srv.nmconnection.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE hosts files for k8s instances
      file:
        path: "/tmp/hosts.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE hostname files for k8s instances
      file:
        path: "/tmp/hostname.{{ item.name }}"
        state: absent
      with_items: "{{ k8s_inst }}"

    - name: DELETE multiple files and authorized_keys files
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - '/tmp/authorized_keys'
        - '/tmp/dnf.conf'
        - '/tmp/kube-pks-install.sh'
        - '/tmp/http-proxy.conf'
        - '/tmp/bash_profile'


