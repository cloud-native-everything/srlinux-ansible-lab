---
    
    - name: grab ip link status
      command: ip link
      register: ip_link
      changed_when: False

    - name: set tap interface in virtual wire DOWN
      command: ip link set dev {{ item.tap_iface1 }} down
      with_items: "{{ k8s_inst }}"
      when:
        - 'item.tap_iface1 in ip_link.stdout'

    - name: set leaf interface connected to k8s in virtual wire DOWN
      command: ip netns exec {{ item.netns }} ip link set dev {{ item.iface1 }} down
      with_items: "{{ k8s_inst }}"
      when:
        - 'item.iface1 in ip_link.stdout' 

    - name: delete virtual wire for every k8s instance
      command: ip link del {{ item.tap_iface1 }} type veth peer name {{ item.iface1 }}
      with_items: "{{ k8s_inst }}"
      when:
        - 'item.tap_iface1 in ip_link.stdout'

    - name: Grab bridge status
      command: brctl show
      register: brctl_show
      changed_when: False


    - name: TURN tap_bridge DOWN for k8s instances
      command: ifconfig {{ item.bridge }} down
      with_items: "{{ k8s_inst }}"
      when:
        - 'item.bridge in brctl_show.stdout'

    - name: DESTROY tap_bridge for k8s instances
      command: brctl delbr {{ item.bridge }}
      with_items: "{{ k8s_inst }}"
      when:
        - 'item.bridge in brctl_show.stdout'
