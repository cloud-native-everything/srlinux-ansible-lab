# Copying script to hypervisor and modify image

- name: Check if the script disable-netmanager.sh exists and have permissions
  stat:
    path: /tmp/disable-netmanager.sh
  register: st

- name: Copying script to hypervisor to remove NetworkManager
  copy:
    src: disable-netmanager.sh
    dest: /tmp/disable-netmanager.sh
    mode: 0755
  when: 
    - st.stat.exists == False

#- name: Copying ifcfg-eth template
#  template: src=temp-ifcfg-eth.j2 backup=no dest=/tmp/temp-ifcfg-eth
#  when: 
#    - st.stat.exists == False

- name: Run the script over the image to remove NetworkManager
  shell: "/tmp/disable-netmanager.sh {{ kvm_images_location }}/{{ item.name }}.qcow2"
  with_items: "{{ k8s_inst }}"
