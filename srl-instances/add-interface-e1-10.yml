---
# Creating tap interfaces nad bridges 
#
    - name: get list of srl leaf instances
      command: ip netns | grep leaf
      register: leaf_inst
      changed_when: False

    - name: Copying certs files
      copy:
        src: "/srl-lab/certs/certs/{{ item }}"
        dest: "/tmp/{{ item }}"
        force: no
        backup: no
      with_items: 
        - 'client.crt'
        - 'client_key.pem'
        - 'rootCA.crt' 

    - name: Copying gnmi JSON files
      copy:
        src: "/srl-lab/srl-instances/{{ item }}"
        dest: "/tmp/{{ item }}"
        force: no
        backup: no
      with_items: 
        - 'mac-vrf1-add-interface-e10.json'
        - 'ethernet-10.json'

    - name: add interface ethernet-1/10 to leaf
      command: 
      cmd: gnmic set --tls-ca rootCA.crt --tls-cert client.crt --tls-key client_key.pem -a {{ item }}:57400 --username admin --password admin -e json_ietf --skip-verify --update-path /interface[name=ethernet-1/10] --update-file ethernet-10.json
        chdir: /tmp
      with_items: "{{ leaf_inst }}"

    - name: add interface ethernet-1/10 to mac-vrf1
      command: 
        cmd: gnmic set --tls-ca rootCA.crt --tls-cert client.crt --tls-key client_key.pem -a {{ item }}:57400 --username admin --password admin -e json_ietf --skip-verify --update-path /interface[name=ethernet-1/3] --update-file ethernet-10.json
        chdir: /tmp
      with_items: "{{ leaf_inst }}"

